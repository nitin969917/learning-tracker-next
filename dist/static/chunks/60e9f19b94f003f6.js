(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,79047,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(22016),i=e.i(18566);let o=({lectureId:e})=>{let[a,i]=(0,s.useState)(""),[o,r]=(0,s.useState)(!0),[l,n]=(0,s.useState)(!1),[c,d]=(0,s.useState)(null);(0,s.useEffect)(()=>{u()},[e]);let u=async()=>{try{let t=await fetch(`/api/notes/lecture/${e}`);if(!t.ok)throw Error("Failed to fetch notes");let s=await t.json();i(s.content||"")}catch(e){console.error("Failed to load notes")}finally{r(!1)}},m=async()=>{n(!0);try{if(!(await fetch(`/api/notes/lecture/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:a})})).ok)throw Error("Failed to save notes");d(new Date)}catch(e){alert("Failed to save notes")}finally{n(!1)}};return((0,s.useEffect)(()=>{if(!o){let e;return e=setTimeout(()=>{a.trim()&&m()},2e3),()=>clearTimeout(e)}},[a,o]),o)?(0,t.jsx)("div",{className:"loading",children:"Loading notes..."}):(0,t.jsxs)("div",{className:"notes-editor",children:[(0,t.jsxs)("div",{className:"notes-header",children:[(0,t.jsx)("h2",{children:"My Notes"}),(0,t.jsxs)("div",{className:"notes-actions",children:[c&&(0,t.jsxs)("span",{className:"last-saved",children:["Saved ",c.toLocaleTimeString()]}),(0,t.jsx)("button",{onClick:m,className:"btn btn-primary",disabled:l,children:l?"Saving...":"Save Notes"})]})]}),(0,t.jsx)("textarea",{className:"notes-textarea",value:a,onChange:e=>i(e.target.value),placeholder:"Write your notes here... You can use markdown formatting.",rows:20}),(0,t.jsx)("p",{className:"notes-hint",children:'ðŸ’¡ Your notes are automatically saved. You can also click "Save Notes" to save manually.'})]})};var r=e.i(63394);let l=({lectureId:e})=>{let[a,i]=(0,s.useState)([]),[o,l]=(0,s.useState)(""),[n,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(""),[m,h]=(0,s.useState)(!0),{user:p}=(0,r.useAuth)();(0,s.useEffect)(()=>{y()},[e]);let y=async()=>{try{let t=await fetch(`/api/discussions/lecture/${e}`);if(!t.ok)throw Error("Failed to load discussions");let s=await t.json();i(s)}catch(e){console.error("Failed to load discussions")}finally{h(!1)}},f=async t=>{if(t.preventDefault(),o.trim())try{if(!(await fetch("/api/discussions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lecture_id:e,content:o})})).ok)throw Error("Failed to post comment");l(""),y()}catch(e){alert("Failed to post comment")}},v=async t=>{if(d.trim())try{if(!(await fetch("/api/discussions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lecture_id:e,parent_id:t,content:d})})).ok)throw Error("Failed to post reply");u(""),c(null),y()}catch(e){alert("Failed to post reply")}},j=async e=>{if(window.confirm("Are you sure you want to delete this comment?"))try{if(!(await fetch(`/api/discussions/${e}`,{method:"DELETE"})).ok)throw Error("Failed to delete comment");y()}catch(e){alert("Failed to delete comment")}};return m?(0,t.jsx)("div",{className:"loading",children:"Loading discussions..."}):(0,t.jsxs)("div",{className:"discussion-thread",children:[(0,t.jsx)("h2",{children:"Discussion"}),(0,t.jsx)("p",{className:"discussion-subtitle",children:"Ask questions, share insights, and help your peers learn!"}),(0,t.jsxs)("form",{onSubmit:f,className:"comment-form",children:[(0,t.jsx)("textarea",{className:"form-textarea",value:o,onChange:e=>l(e.target.value),placeholder:"Write a comment...",rows:3}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Post Comment"})]}),(0,t.jsx)("div",{className:"comments-list",children:0===a.length?(0,t.jsx)("p",{className:"no-comments",children:"No comments yet. Be the first to comment!"}):a.map(e=>(0,t.jsxs)("div",{className:"comment-item",children:[(0,t.jsxs)("div",{className:"comment-header",children:[(0,t.jsxs)("div",{className:"comment-author",children:[(0,t.jsx)("strong",{children:e.username}),(0,t.jsx)("span",{className:"comment-date",children:new Date(e.created_at).toLocaleString()})]}),e.user_id===p?.id&&(0,t.jsx)("button",{onClick:()=>j(e.id),className:"btn-delete-comment",children:"Delete"})]}),(0,t.jsx)("div",{className:"comment-content",children:e.content}),(0,t.jsx)("button",{onClick:()=>c(n===e.id?null:e.id),className:"btn-reply",children:n===e.id?"Cancel":"Reply"}),n===e.id&&(0,t.jsxs)("div",{className:"reply-form",children:[(0,t.jsx)("textarea",{className:"form-textarea",value:d,onChange:e=>u(e.target.value),placeholder:"Write a reply...",rows:2}),(0,t.jsx)("button",{onClick:()=>v(e.id),className:"btn btn-primary btn-sm",children:"Post Reply"})]}),e.replies&&e.replies.length>0&&(0,t.jsx)("div",{className:"replies-list",children:e.replies.map(e=>(0,t.jsxs)("div",{className:"reply-item",children:[(0,t.jsxs)("div",{className:"reply-header",children:[(0,t.jsx)("strong",{children:e.username}),(0,t.jsx)("span",{className:"reply-date",children:new Date(e.created_at).toLocaleString()}),e.user_id===p?.id&&(0,t.jsx)("button",{onClick:()=>j(e.id),className:"btn-delete-comment",children:"Delete"})]}),(0,t.jsx)("div",{className:"reply-content",children:e.content})]},e.id))})]},e.id))})]})};function n(){let{id:e}=(0,i.useParams)();(0,i.useRouter)();let[r,n]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0),[u,m]=(0,s.useState)(""),[h,p]=(0,s.useState)(null),[y,f]=(0,s.useState)("video"),[v,j]=(0,s.useState)(null);(0,s.useRef)(null),(0,s.useEffect)(()=>{b(),w()},[e]),(0,s.useEffect)(()=>{if(window.YT)window.YT&&window.YT.Player&&N();else{let e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t&&t.parentNode?t.parentNode.insertBefore(e,t):document.body.appendChild(e),window.onYouTubeIframeAPIReady=()=>{N()}}return()=>{v&&v.destroy}},[r?.youtube_video_id]);let N=()=>{!r?.youtube_video_id||document.getElementById("youtube-player")&&setTimeout(()=>{if(window.YT&&window.YT.Player)try{new window.YT.Player("youtube-player",{videoId:r.youtube_video_id,events:{onStateChange:e=>{e.data===window.YT.PlayerState.ENDED&&x()},onReady:e=>{j(e.target)}}})}catch(e){console.error("Failed to initialize YouTube player:",e)}},500)},x=async()=>{if(!r?.is_completed)try{if(!(await fetch(`/api/lectures/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_completed:!0})})).ok)throw Error("Failed to auto-complete lecture");b();let t=document.createElement("div");t.className="auto-complete-notification",t.textContent="âœ“ Video completed! Marked as done.",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)}catch(e){console.error("Failed to auto-complete lecture:",e)}},b=async()=>{try{let t=await fetch(`/api/lectures/${e}`);if(!t.ok)throw Error("Failed to fetch lecture");let s=await t.json();n(s)}catch(e){m("Failed to load lecture"),console.error(e)}finally{d(!1)}},w=async()=>{try{let t=await fetch(`/api/revisions/lecture/${e}`);if(t.ok){let e=await t.json();p(e)}}catch(e){console.error("Failed to load revision data")}},g=async()=>{try{if(!(await fetch(`/api/lectures/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_completed:!r.is_completed})})).ok)throw Error("Failed to update lecture");b()}catch(e){m(e.message)}},k=async t=>{try{if(!(await fetch(`/api/lectures/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({difficulty:t})})).ok)throw Error("Failed to update difficulty");b()}catch(e){m(e.message)}},S=async()=>{try{let t=await fetch(`/api/revisions/lecture/${e}`,{method:"POST"});if(!t.ok)throw Error("Failed to mark revision");let s=await t.json();p(s)}catch(e){m(e.message)}};if(c)return(0,t.jsx)("div",{className:"loading",children:"Loading lecture..."});if(!r)return(0,t.jsx)("div",{className:"error",children:"Lecture not found"});let T=r.youtube_video_id,C=T?`https://www.youtube.com/embed/${T}`:null;return(0,t.jsx)("div",{className:"lecture-detail",children:(0,t.jsxs)("div",{className:"container",children:[(0,t.jsx)(a.default,{href:`/courses/${r.course_id}`,className:"back-link",children:"â† Back to Course"}),(0,t.jsxs)("div",{className:"lecture-header-card",children:[(0,t.jsxs)("div",{className:"lecture-title-section",children:[(0,t.jsx)("h1",{className:"lecture-title",children:r.title}),(0,t.jsxs)("div",{className:"lecture-meta",children:[(0,t.jsx)("span",{className:`difficulty-badge ${r.difficulty?.toLowerCase()||"medium"}`,children:r.difficulty||"Medium"}),r.is_completed&&(0,t.jsx)("span",{className:"completed-badge",children:"âœ“ Completed"}),h&&h.revision_count>0&&(0,t.jsxs)("span",{className:"revision-badge",children:["ðŸ”„ Revised ",h.revision_count," time(s)"]})]})]}),(0,t.jsxs)("div",{className:"lecture-actions",children:[(0,t.jsx)("button",{onClick:g,className:`btn ${r.is_completed?"btn-secondary":"btn-success"}`,children:r.is_completed?"Mark Incomplete":"Mark Complete"}),(0,t.jsx)("button",{onClick:S,className:"btn btn-primary",children:"Mark as Revised"}),(0,t.jsxs)("select",{value:r.difficulty||"Medium",onChange:e=>k(e.target.value),className:"form-select difficulty-select",children:[(0,t.jsx)("option",{value:"Easy",children:"Easy"}),(0,t.jsx)("option",{value:"Medium",children:"Medium"}),(0,t.jsx)("option",{value:"Hard",children:"Hard"})]})]})]}),u&&(0,t.jsx)("div",{className:"error",children:u}),(0,t.jsxs)("div",{className:"tabs",children:[(0,t.jsx)("button",{className:`tab ${"video"===y?"active":""}`,onClick:()=>f("video"),children:"ðŸ“¹ Video"}),(0,t.jsx)("button",{className:`tab ${"notes"===y?"active":""}`,onClick:()=>f("notes"),children:"ðŸ“ Notes"}),(0,t.jsx)("button",{className:`tab ${"discussion"===y?"active":""}`,onClick:()=>f("discussion"),children:"ðŸ’¬ Discussion"})]}),(0,t.jsxs)("div",{className:"tab-content",children:["video"===y&&(0,t.jsx)("div",{className:"card",children:C?(0,t.jsxs)("div",{className:"video-container",children:[(0,t.jsx)("div",{id:"youtube-player"}),r.duration_seconds>0&&(0,t.jsxs)("p",{className:"video-duration",children:["Duration: ",(e=>{if(!e)return"Unknown";let t=Math.floor(e/3600),s=Math.floor(e%3600/60),a=e%60;return t>0?`${t}h ${s}m ${a}s`:s>0?`${s}m ${a}s`:`${a}s`})(r.duration_seconds)]})]}):(0,t.jsxs)("div",{className:"no-video",children:[(0,t.jsx)("p",{children:"No video URL provided for this lecture."}),r.youtube_url&&(0,t.jsx)("a",{href:r.youtube_url,target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary",children:"Open YouTube Link"})]})}),"notes"===y&&(0,t.jsx)("div",{className:"card",children:(0,t.jsx)(o,{lectureId:e})}),"discussion"===y&&(0,t.jsx)("div",{className:"card",children:(0,t.jsx)(l,{lectureId:e})})]})]})})}e.s(["default",()=>n],79047)}]);